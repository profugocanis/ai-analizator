<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trading AI Analyzer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    input, button { padding: 0.5rem; margin: 0.5rem 0; width: 100%; }
    pre { background: #f4f4f4; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Trading AI Analyzer</h1>
  <label>MarketAux API Key</label>
  <input id="marketauxKey" placeholder="Enter MARKETAUX_API_KEY" />
  <label>Gemini API Key</label>
  <input id="geminiKey" placeholder="Enter GEMINI_API_KEY" />
  <label>Tickers (comma-separated)</label>
  <input id="tickers" placeholder="e.g. ^DJI,BTC,AAPL" />
  <button id="run">Run Analysis</button>
  <pre id="output"></pre>

  <script>
    async function fetchNews(tickers, pagesCount, apiKey) {
      const allHeadlines = [];
      const base = 'https://api.marketaux.com/v1/news/all';
      for (let page = 1; page <= pagesCount; page++) {
        const url = new URL(base);
        url.search = new URLSearchParams({
          symbols: tickers,
          page,
          filter_entities: 'true',
          language: 'en',
          api_token: apiKey
        });
        const res = await fetch(url);
        const data = await res.json();
        (data.data || []).forEach(a => {
          allHeadlines.push(`${a.title}: ${a.description}`);
        });
      }
      return allHeadlines;
    }

    async function analyzeWithAI(headlines, apiKey) {
      const promptHeader = `
Role: You are an expert financial analyst and risk assessor.
Task: Perform a comprehensive sentiment and impact analysis of the following news article. Provide your output in a clear, structured format.
Analysis Dimensions:
1. Overall Sentiment: Classify as Bullish, Bearish, or Neutral.
2. Sentiment Score: Provide a score from -1.0 (extremely bearish) to +1.0 (extremely bullish).
3. Key Entities Mentioned: List the primary companies, people, or products involved.
4. Core Thesis: In a single sentence, what is the main argument or piece of information in the article?
5. Justification: Briefly explain the reasoning behind your sentiment score, citing specific evidence from the text.
6. Potential Impact & Time Horizon: Describe the likely impact on the key entity's stock price and specify if it's short-term (days/weeks) or long-term (quarters/years).
7. Identified Risks & Caveats: What are the potential risks, counterarguments, or uncertainties mentioned or implied in the text?

News Article to Analyze:
`;
      const payload = {
        contents: [{ parts: [{ text: promptHeader + headlines.join('\n') }] }]
      };
      const res = await fetch(
        'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent',
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-goog-api-key': apiKey
          },
          body: JSON.stringify(payload)
        }
      );
      const json = await res.json();
      return (json.candidates?.[0]?.content?.parts?.[0]?.text)
             || 'No response text found.';
    }

    document.getElementById('run').onclick = async () => {
      const k1 = document.getElementById('marketauxKey').value.trim();
      const k2 = document.getElementById('geminiKey').value.trim();
      const tickers = document.getElementById('tickers').value.trim();
      const output = document.getElementById('output');
      output.textContent = 'Loadingâ€¦';
      try {
        const news = await fetchNews(tickers, 5, k1);
        const analysis = await analyzeWithAI(news, k2);
        output.textContent = analysis;
      } catch (err) {
        output.textContent = 'Error: ' + err.message;
      }
    };
  </script>
</body>
</html>
